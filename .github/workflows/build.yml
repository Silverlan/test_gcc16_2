jobs:
  build-on-host-then-container:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Free disk on runner (host)
        run: |
          sudo apt-get clean
          sudo rm -rf /var/lib/apt/lists/*
          sudo rm -rf /home/runner/.cache/*
          # prune docker images/containers if docker is present
          docker system prune -af || true

      - name: Run build inside container on same VM
        env:
          GITHUB_WORKSPACE: ${{ github.workspace }}
        run: |
          # run the container yourself so it runs on the same VM you just cleaned
          docker run --rm \
            -v "$GITHUB_WORKSPACE":/work \
            -w /work \
            ghcr.io/mattkretz/cplusplus-ci/gcc16 \
            sh -c "make"
